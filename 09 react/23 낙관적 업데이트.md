## 낙관적 업데이트

- 기존 업데이트 방식 (비관적 업데이트): 사용자 클릭 → 로딩 표시 → 서버 요청 → 응답 대기 → 성공 시 UI 업데이트
- 낙관적 업데이트: 사용자 클릭 → UI 업데이트 → 서버 요청 → 종료 / 실패 시 롤백 (옛날 화면으로 롤백)
- `useMutation()`으로 구현
  <br/>

## 낙관적 업데이트 4단계

1. mutationFn
   - 서버에 추가 요청을 보내는 함수
2. onMutate
   - 요청이 서버로 가기 전에 실행 (화면 갱신)
   - 이 부분에서 낙관적 업데이트 (Optimistic Update) 진행
   - 서버의 응답과 관계 없이 UI에 반영
3. onError
   - 서버에서 요청이 실패했을 때 실행
   - 낙관적 업데이트를 롤백 (원상복구)
4. onSettled
   - 성공 / 실패와 상관없이 요청이 끝나면 실행
   - 보통 이 부분에서 쿼리로 최근 데이터로 동기화 (서버 데이터와 프론트 데이터를 동기화)

## 낙관적 업데이트 장단점

### 장점

- 빠른 반응성 (로딩 시간이 없어짐)
- 자연스러운 느낌을 낼 수 있음
- 오프라인 지원: 네트워크가 없어도 동작 가능

## 단점

- 복잡성 증가
- 일관성이 깨질 수 있음
- 실패 시 사용자에게 명확하게 피드백을 제공해야 함

## 낙관적 업데이트 사용 예시

- 토글, 좋아요, 삭제, …
- 성공확률이 높은 곳
- 부적합한 경우: 금융, 의료 등 데이터가 중요한 서비스, 서버 검증이 필요한 경우, 상태 관리하는 것이 여러 컴포넌트 연관되는 것들 (롤백의 어려움)
