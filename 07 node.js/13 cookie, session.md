## Cookie
- **웹 브라우저에 저장**되는 키와 값이 들어있는 작은 데이터 파일
- 이름, 값, 만료일, 경로 등의 정보로 구성
- 동작 방식
  - 1️⃣ 클라이언트가 페이지를 요청
  - 2️⃣ 서버에서 쿠키를 생성
  - 3️⃣ HTTP `Set-Cookie`헤더에 쿠키를 포함시켜 응답(`Set-Cookie: username=John; Max-Age=3600; Path=/`)
  - 4️⃣ 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관
  - 5️⃣ 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 내보냄
  - 6️⃣ 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이터하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답 
- 쿠키에는 사용자 정보를 직접 담기도 하고, 인증 토큰(JWT 등)을 담기도 함
```javascript
const cookieParser = require("cookie-parser");
app.use(cookieParser());

res.cookie("쿠키 키", "쿠키 값", "옵션 객체");
```
<br/>

## Session
- **웹 서버에 저장**되는 쿠키
- **서버가 관리하는 사용자 상태 정보**
- 사용자가 웹 브라우저를 통해 접속한 시점부터 연결을 끝내는 시점까지의 시간 동안 일련의 요구를 하나의 상태로 보고 **그 상태를 유지**시킴 
- 동작 방식
  - 1️⃣ 클라이언트가 서버에 접속 시 세션 ID를 발급받음 (`Set-Cookie: sessionId=abc123`)
  - 2️⃣ 클라이언트는 세션 ID를 쿠키로 저장 
  - 3️⃣ 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달해서 사용
  - 4️⃣ 서버는 세션 ID를 전달받아서 별다른 작업 없이 세션 ID로 세션에 있는 클라이언트 정보를 가져옴
    - 서버는 이 ID에 대응하는 사용자 데이터를 서버 메모리나 DB에서 관리
  - 5️⃣ 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답 
```javascript
const session = require('express-session');
app.use(session('옵션 객체'))

// req.session.key = value
req.session.id = req.body.id;
```
<br/>

## Cookie vs. Session
### 공통점
- 웹에서 사용자 상태를 유지하기 위한 기술
- HTTP: 상태를 유지하지 않는 stateless 프로토콜 
### 차이점

|항목|쿠키 (Cookie)| 세션 (Session)|
|---|---|---|
|저장 위치|클라이언트(브라우저)|서버|
|저장 방식|요청마다 자동으로 함께 전송됨|세션 ID만 쿠키에 저장, 실제 데이터는 서버에 저장|
|용량 제한|약 4KB|서버 메모리 크기에 따라 다름|
|유효 기간|명시적으로 설정 가능 (`Expires`, `Max-Age`)|브라우저 종료 시 기본 만료 (설정 가능)|
|보안|상대적으로 취약 (클라이언트에서 조작 가능)|상대적으로 안전 (세션 ID만 노출됨)|
|속도|클라이언트에서 처리되므로 빠름|서버에 접근해야 하므로 상대적으로 느림|
|사용 예시|자동 로그인, 사용자 설정 저장(테마 설정, 장바구니 미리보기...) 등|로그인 상태 유지, 사용자 인증 정보|

### 보안 

| 항목           | 설명                                                                 |
|----------------|----------------------------------------------------------------------|
| 쿠키           | - 클라이언트에 저장됨 → 열람/변경 가능성 있음<br>- 민감 정보 저장 비추천 |
| 세션           | - 서버에 저장됨 → 클라이언트는 세션 ID만 가짐<br>- 상대적으로 안전        |
| 보안 위험      | - 쿠키: 탈취, 변조<br>- 세션: 세션 하이재킹 (세션 ID 탈취) 위험             |
| 권장 사용 방식 | - 중요한 정보는 세션 사용<br>- 쿠키에는 토큰 또는 키만 저장                 |

### 속도

| 항목     | 설명                                                                  |
|----------|-----------------------------------------------------------------------|
| 쿠키     | - 클라이언트에 저장되어 바로 접근 가능<br>- 처리 속도가 빠름         |
| 세션     | - 서버 접근 필요 (요청마다 세션 조회)<br>- 처리 속도 상대적으로 느림 |
| 최적 활용 | - 비중요한 데이터는 쿠키, 보안 정보는 세션으로 구분 저장             |
